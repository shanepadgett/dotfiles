# --- Completion system ---
autoload -Uz compinit
# Rebuild completion cache only when needed (keeps startup faster)
if [[ -n ~/.zcompdump(#qN.mh+24) ]]; then
  compinit
else
  compinit -C
fi

# Homebrew completions
if [[ -d "$(brew --prefix)/share/zsh/site-functions" ]]; then
  fpath=("$(brew --prefix)/share/zsh/site-functions" $fpath)
fi

# Add deno completions to search path
if [[ ":$FPATH:" != *":/Users/shanepadgett/.zsh/completions:"* ]]; then export FPATH="/Users/shanepadgett/.zsh/completions:$FPATH"; fi

# Exports
export PATH="$HOME/.local/bin:$PATH"
export EDITOR="zed --wait"
export GITHUB_USERNAME="shanepadgett"
export DEV_PATH="$HOME/dev"
export DO_NOT_TRACK=1

# --- Modern Replacements (The "Big Upgrades") ---
# Replace ls with eza (adds icons, git status, and better colors)
alias ls='eza --icons --group-directories-first'
alias ll='eza -lah --icons --group-directories-first --git'
alias la='eza -A --icons'
alias tree='eza --tree --icons'

# Replace cat with bat (syntax highlighting and paging)
alias cat='bat --paging=never'
alias preview='bat'

# Replace grep with ripgrep (way faster, respects .gitignore)
alias grep='rg'

# Replace find with fd
alias find='fd'

# --- Tool Specific Aliases ---
# Chezmoi
alias cm="chezmoi"
alias cma="chezmoi add"
alias cme="chezmoi edit --apply"
alias cmes="chezmoi-symlink edit"
alias cmdf="chezmoi diff"
alias cmap="chezmoi -v apply"
alias cmu="chezmoi update"
alias cz="cme ~/.zshrc"

# Directory Nav
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'
alias ~='cd ~'
alias dev='cd $DEV_PATH'

# Teach me helpers
alias h='history 0'
alias hg='history 0 | rg'     # search history with ripgrep
alias which='type -a'         # more informative than macOS which
alias path='echo $PATH | tr ":" "\n"'
alias fpath='echo $fpath | tr " " "\n"'

# Git (Keeping your flow, but adding lazygit)
alias g='git'
alias lg='lazygit'  # This is a game changer for staging hunks
alias ga='git add'
alias gaa='git add --all'
alias gc='git commit -m'
alias gca='git commit -am'
alias gp='git push'
alias gpl='git pull'
alias gst='git status'
alias gl='git log --oneline --graph --decorate'
alias gco='git checkout'

# System
alias top='btop'    # Use that aesthetic system monitor instead of top
alias help='tldr'   # Use tldr for quick command examples
alias brewup="brew bundle --file=~/Brewfile"

# Utilities
alias cc='pbcopy <'
alias reload='source ~/.zshrc' # Renamed from 'source' to avoid shadowing the command

# --- Advanced FZF Integration ---
# This allows you to use 'fzf' to quickly find and open files in Zed
# usage: fo <filename>
fo() {
  local file
  if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    file=$(git ls-files | fzf)
  else
    file=$(fd --type f | fzf)
  fi
  [[ -n "$file" ]] && zed "$file"
}

proj() {
  local dir
  dir=$(fd --type d --max-depth 4 . $DEV_PATH 2>/dev/null | fzf) && cd "$dir"
}

# --- Inits (Must remain at the end) ---
eval "$(fnm env --use-on-cd)"
eval "$(zoxide init zsh)"
eval "$(starship init zsh)"
# Initialize fzf (enables Ctrl+R history search and Tab completion)
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
. "/Users/shanepadgett/.deno/env"
